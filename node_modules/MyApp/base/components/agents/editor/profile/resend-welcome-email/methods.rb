class Agents

  def resend_welcome_email user_id, subject, body

    email = Email[:agent_welcome]
    email || halt(400, 'Email not found')

    @user.update_column(:password_reset_token, Helpers.generate_random_token)

    subject, body = Email.render(
      subject,
      body,
      render_context: {user: @user.serialized},
      layout: email.layout && email.layout.content
    )

    MailSpool.create({
      user_id: @user.id,
      email_id: email.id,
      email: @user.email,
      subject: subject,
      body: body,
      cc: email.cc,
      bcc: email.bcc
    })

    @user.update_column(:welcome_email_resent_at, Time.now.utc)
    true
  end
end
