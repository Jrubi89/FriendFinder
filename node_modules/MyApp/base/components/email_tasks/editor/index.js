import Emails from './emails'
import Scheduler from './scheduler'
import Status from './status'

export default {
  template: require('./template'),

  components: {
    Emails,
    Scheduler,
    Status
  },

  created() {
    this.$store.commit('CRUDLE__UPDATE_UI', false)

    this.env.rtcp.subscribe(`email_tasks.${this.item.id}.status`, (status) => {
      this.$store.commit('EMAIL_TASKS__UPDATE_NUMBERS', status.numbers)
      if (status.completed)
        this.$store.commit('CRUDLE__UPDATE_ITEM', {completed: true, finished: true})
    })
  },

  computed: {
    active_component() {return this.item.started_at ? 'Status' : 'Scheduler'}
  }
}
