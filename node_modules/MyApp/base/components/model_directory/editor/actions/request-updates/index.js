import {trim, omit} from 'lodash'
import Alert from 'appril-alert'
import {strip_tags} from 'appril-utils'

import Editor from '../editor'

export default {
  props: ['profile', 'label'],
  template: require('./template'),

  data() {return {
    editor: false
  }},

  components: {
    Editor
  },

  methods: {
    initiate() {
      this.editor = true
    },

    close_editor() {
      this.editor = false
    },

    request(requested_updates) {

      if (trim(strip_tags(requested_updates)).length == 0)
        return Alert.error('Please describe what should be updated')

      this.api.request_updates(this.profile.id, requested_updates).send({
        success: (profile) => {
          this.close_editor()
          this.$store.commit('CRUDLE__UPDATE_ITEM', profile)
          Alert.success()
        }
      })
    }
  }
}
