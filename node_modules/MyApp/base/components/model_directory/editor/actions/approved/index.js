import {trim} from 'lodash'
import Alert from 'appril-alert'
import {strip_tags} from 'appril-utils'

import Editor from '../editor'

export default {
  props: ['profile'],
  template: require('./template'),

  data() {return {
    editor: false
  }},

  components: {
    Editor
  },

  methods: {
    initiate() {
      Alert.confirm('Important', {
        text: 'You are about to UN-PUBLISH current profile and request updates from user'
      }, () => this.editor = true)
    },

    disapprove(requested_updates) {

      if (trim(strip_tags(requested_updates)).length == 0) {
        return Alert.error('Please describe what should be updated')
      }

      this.api.disapprove(this.profile.id, requested_updates).send({
        success: (profile) => {
          this.close_editor()
          this.$store.commit('CRUDLE__UPDATE_ITEM', profile)
        }
      })
    },

    close_editor() {this.editor = false}
  }
}
