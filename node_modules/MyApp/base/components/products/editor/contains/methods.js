import {map} from 'lodash'
import Alert from 'appril-alert'
import Serialize from 'form-serialize'

export function create(evt) {
  let [
    contained_product_id,
    inventory_items
  ] = map(Serialize(evt.target.closest('form'), {hash: true}), (id) => parseInt(id))

  if (contained_product_id === 0)
    return Alert.error('Please select product')

  if (inventory_items === 0)
    return Alert.error('Please insert inventory items')

  this.api.add_contained_product(this.url.params.id, contained_product_id, inventory_items).send({
    success: () => this.$store.commit('PRODUCTS__ADD_CONTAINED_PRODUCT', {
      product_id: contained_product_id,
      inventory_items: inventory_items
    })
  })
}

export function remove(row) {
  Alert.confirm(() => {
    this.api.delete_contained_product(this.url.params.id, row.product_id).send({
      success: () => this.$store.commit('PRODUCTS__DELETE_CONTAINED_PRODUCT', row)
    })
  })
}
