class Products

  def add_contained_product product_id, contained_product_id, inventory_items
    contained_product = model.find_by(id: path_params[:contained_product_id])
    contained_product || halt(400, 'No Product found by given ID')

    if contained_product.id == @product.id
      halt(400, 'A product can not contain itself')
    end

    @product.contains ||= []

    if @product.contains.find {|line| line['product_id'] == contained_product.id}
      halt(400, "Product already added")
    end

    inventory_items = inventory_items.to_i

    unless inventory_items > 0
      halt(400, "Inventory items should be set to 1 or more")
    end

    @product.contains << {product_id: contained_product.id, inventory_items: inventory_items}

    @product.save
    true
  end

  def delete_contained_product product_id, contained_product_id
    @product.contains ||= []
    @product.contains.delete_if {|line| line['product_id'] == contained_product_id.to_i}
    @product.save
    true
  end

end
