class Geo < BaseController
  CITY_QUERY = 'name ILIKE ?'.freeze
  CITY_QUERY_FORMAT = '%s%'.freeze

  def states_for country_code
    country = Country.find_by(code: country_code) || halt(404, 'Country not found')
    [
      country.states.map(&:serialized)
    ]
  end

  def cities country_code, state_code, input
    [
      City.where(country_code: country_code, state_code: state_code).where(CITY_QUERY, CITY_QUERY_FORMAT % input).pluck(:name)
    ]
  end
end
