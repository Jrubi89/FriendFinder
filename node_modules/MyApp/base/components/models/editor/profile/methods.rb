class Models

  def request_more_info user_id, email_uuid, subject, body

    email = Email[email_uuid]
    email || halt(400, 'Email not found')

    subject, body = Email.render(
      subject,
      body,
      render_context: {user: @user.serialized},
      layout: email.layout && email.layout.content
    )

    MailSpool.create({
      user_id: @user.id,
      email_id: email.id,
      email: @user.email,
      subject: subject,
      body: body,
      cc: email.cc,
      bcc: email.bcc
    })

    @user.update_column(email_uuid, Time.now.utc)
    true
  end

  def welcome_package user_id
    o = @user.orders.where(welcome_package: true).first_or_create(draft: true)
    redirect Orders.url(id: o.id, user_id: @user.id)
  end
end
