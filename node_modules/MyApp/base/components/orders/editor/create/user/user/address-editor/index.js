import Serialize from 'form-serialize'
import Alert from 'appril-alert'
import Geo from 'appril-geo'

export default {
  props: ['user'],
  template: require('./template'),

  components: {
    Geo: Geo({
      props: ['country', 'state', 'city'],
      created() {
        this.api = this.env.components.Geo.rtcp
        this.countries = this.env.countries
      }
    })
  },

  methods: {
    close_address_editor() {this.$store.commit('ORDERS__EDIT_ADDRESS', false)},

    save(evt) {
      let address = Serialize(evt.target.closest('form'), {hash: true})
      this.env.components.Users.api.update_address(this.user.id, address).send({
        success: () => {
          this.$store.commit('ORDERS__UPDATE_USER', address)
          this.close_address_editor()
        }
      })
    }
  }
}
