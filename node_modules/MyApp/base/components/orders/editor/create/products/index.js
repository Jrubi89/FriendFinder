import {filter, map, reduce} from 'lodash'
import Product from './product'

export default {
  template: require('./template'),

  components: {
    Product
  },

  computed: {
    products() {
      let contained_products = reduce(this.$options.products, (f,c) => (f.concat(map(c.contains, 'product_id'))), [])

      return filter(this.$options.products, (p) => {
        if (contained_products.indexOf(p.id) >= 0)
          return
        return this.current_category ?
          p.category_id === this.current_category :
          true
      })
    },

    current_category(state) {return this.$store.state.Orders.current_category}
  },

  methods: {
    filter_products_by_category(evt) {
      this.$store.commit('ORDERS__SET_CATEGORY', parseInt(evt.target.options[evt.target.selectedIndex].value))
    }
  }
}
